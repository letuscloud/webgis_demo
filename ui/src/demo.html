<!DOCTYPE html>
<html>

<head>
    <title>Leaflet.RouteAnimate</title>
    <meta charset="utf-8" />
    <!-- 引入leafletapi -->
    <link rel="stylesheet" href="../lib/leaflet/leaflet.css" />
    <script src="../lib/leaflet/leaflet.js"></script>

    <!-- 引入插件 -->
    <script src="../lib/leaflet/plugins/leaflet.polylineDecorator.js"></script>
    <script src="../lib/leaflet/plugins/Leaflet.AnimatedMarker.js"></script>
    <script src="./demo.js"></script>

    <style>
        body {
            margin: 0;
        }

        .map {
            position: absolute;
            height: 100%;
            right: 0;
            left: 0;
        }

        .menuBar {
            position: relative;
            text-align: center;
            top: 10px;
            margin: 0 50px;
            padding: 5px;
            border-radius: 3px;
            z-index: 999;
            color: #ffffff;
            background-color: rgba(0, 168, 0, 1);
        }
    </style>
</head>

<body>
    <div class="map" id="map"></div>
    <div class="menuBar">
        <input type="button" value="开始" onclick="startClick()" />
        <input type="button" value="暂停" onclick="pauseClick()" />
        <input type="button" value="加速" onclick="speetUp()" />
        <input type="button" value="减速" onclick="speetDown()" />
        <input type="button" value="停止" onclick="stopClick()" />


        <label>Route Color:</label>
        <select id="line_color" onchange="handleLineColorSelectChange(event)">
            <option value="Red">Red</option>
            <option value="Blue">Blue</option>
            <option value="Green">Green</option>
            <option value="Yellow">Yellow</option>
        </select>



        <label>Line Width:</label>
        <select id="line_weight" onchange="handleLineWeightSelectChange(event)">
            <option value="4">4</option>
            <option value="8">8</option>
            <option value="12">12</option>
        </select>


        <label>Icon Size:</label>
        <select id="icon_size" onchange="handleIconSizeSelectChange(event)">
            <option value="1">Normal</option>
            <option value="2">Medium</option>
            <option value="3">Large</option>
        </select>

    </div>
</body>



<script>

    var init_icon_width = 37;
    var init_icon_height = 26;

    function handleLineColorSelectChange(event) {

        var selectElement = event.target;
        var value = selectElement.value;


        update_line_color(value);
    };

    function handleLineWeightSelectChange(event) {

        var selectElement = event.target;
        var value = selectElement.value;

        update_line_weight(value);
    };

    function handleIconSizeSelectChange(event) {

        var selectElement = event.target;
        var value = Number(selectElement.value);

        update_icon_size(init_icon_width * value, init_icon_height * value);
    };




    var map = L.map('map', {
        center: [22.548334842855944, 114.0608463257408],
        zoom: 14,
        preferCanvas: true
    });

    var tiles = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map);

    var carIcon = L.icon({
        iconSize: [init_icon_width, init_icon_height],
        // iconAnchor: [19, 13],
        iconUrl: '../img/car.png'
    })
   

// Create WebSocket connection.
const socket = new WebSocket("ws://192.168.1.100:8080/pull");

// Connection opened
socket.addEventListener("open", (event) => {
  socket.send("Hello Server!");
});

// Listen for messages
socket.addEventListener("message", (event) => {

    var x = JSON.parse(event.data);
    
    for (let i = 0; i < x.length; i++) {


        var j = x[i];
        var car_id = j[0]
        var lat = j[1];
        var lng = j[2];

        update_new_pos(car_id, lat, lng, () => {
            return new CarMarker(map, carIcon);
        });
    }
    // console.log("recv", event.data);

});


</script>

</html>